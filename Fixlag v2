--==================================================
-- MINH THUáº¬N HUB | UNIVERSAL FIX LAG
-- AirHub Style | Mobile Friendly
--==================================================

local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer

---------------------------------------------------
-- STATE
---------------------------------------------------
local State = {
    FX = false,
    Sound = false,
    Gray = false,
    Hide = false
}

---------------------------------------------------
-- CORE FUNCTIONS (SAFE)
---------------------------------------------------
local function clearFX()
    for _,v in ipairs(Lighting:GetChildren()) do
        if v:IsA("PostEffect") then
            v.Enabled = false
        end
    end

    for _,d in ipairs(workspace:GetDescendants()) do
        if d:IsA("ParticleEmitter") or d:IsA("Trail") or d:IsA("Beam") then
            d.Enabled = false
        end
        if d:IsA("Explosion") then
            d.Visible = false
        end
    end
end

local function disableCameraShake()
    RunService:BindToRenderStep("NoShake", Enum.RenderPriority.Camera.Value + 1, function()
        workspace.CurrentCamera.CFrame = workspace.CurrentCamera.CFrame
    end)
end

local function removeDebris()
    for _,p in ipairs(workspace:GetChildren()) do
        if p:IsA("Part") and not p.Anchored and p.CanCollide == false then
            p:Destroy()
        end
    end
end

local function grayCharacters()
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr.Character then
            for _,v in ipairs(plr.Character:GetDescendants()) do
                if v:IsA("BasePart") then
                    v.Material = Enum.Material.SmoothPlastic
                    v.Color = Color3.fromRGB(150,150,150)
                end
                if v:IsA("Decal") or v:IsA("Texture") then
                    v.Transparency = 1
                end
            end
        end
    end
end

local function disableSounds()
    for _,s in ipairs(workspace:GetDescendants()) do
        if s:IsA("Sound") then
            s.Volume = 0
            s.Playing = false
        end
    end
end

local function hidePlayers()
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character then
            plr.Character:Destroy()
        end
    end
end

---------------------------------------------------
-- SERVER FUNCTIONS
---------------------------------------------------
local function findLowServer()
    local placeId = game.PlaceId
    local servers = HttpService:JSONDecode(game:HttpGet(
        "https://games.roblox.com/v1/games/"..placeId.."/servers/Public?sortOrder=Asc&limit=100"
    ))
    for _,s in ipairs(servers.data) do
        if s.playing < s.maxPlayers - 5 then
            TeleportService:TeleportToPlaceInstance(placeId, s.id, LocalPlayer)
            break
        end
    end
end

---------------------------------------------------
-- GUI
---------------------------------------------------
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "MinhThuanHub"
gui.ResetOnSpawn = false

local main = Instance.new("Frame", gui)
main.Size = UDim2.fromScale(0.85,0.6)
main.Position = UDim2.fromScale(0.075,0.2)
main.BackgroundColor3 = Color3.fromRGB(45,15,70)
main.Active = true
main.Draggable = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0,16)

local title = Instance.new("TextLabel", main)
title.Size = UDim2.fromScale(1,0.1)
title.Text = "MINH THUáº¬N HUB"
title.Font = Enum.Font.GothamBold
title.TextScaled = true
title.TextColor3 = Color3.fromRGB(230,200,255)
title.BackgroundTransparency = 1

local credit = Instance.new("TextLabel", main)
credit.Position = UDim2.fromScale(0,0.92)
credit.Size = UDim2.fromScale(1,0.08)
credit.Text = "Created by Minh Thuáº­n | Universal Fix Lag"
credit.Font = Enum.Font.Gotham
credit.TextScaled = true
credit.TextColor3 = Color3.fromRGB(180,150,220)
credit.BackgroundTransparency = 1

---------------------------------------------------
-- BUTTON MAKER
---------------------------------------------------
local function makeButton(text,y,callback)
    local b = Instance.new("TextButton", main)
    b.Position = UDim2.fromScale(0.05,y)
    b.Size = UDim2.fromScale(0.9,0.08)
    b.Text = text
    b.Font = Enum.Font.Gotham
    b.TextScaled = true
    b.TextColor3 = Color3.new(1,1,1)
    b.BackgroundColor3 = Color3.fromRGB(70,30,120)
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,12)
    b.MouseButton1Click:Connect(callback)
end

---------------------------------------------------
-- MAIN TAB
---------------------------------------------------
makeButton("MASTER FIX LAG\n(Báº­t toÃ n bá»™)",0.12,function()
    clearFX()
    disableCameraShake()
    removeDebris()
    grayCharacters()
    disableSounds()
end)

makeButton("REMOVE EFFECTS\n(XÃ³a hiá»‡u á»©ng)",0.22,clearFX)
makeButton("DISABLE CAMERA SHAKE\n(Táº¯t rung)",0.32,disableCameraShake)
makeButton("REMOVE DEBRIS\n(XÃ³a part rÆ¡i)",0.42,removeDebris)
makeButton("GRAY MODE\n(NhÃ¢n váº­t xÃ¡m)",0.52,grayCharacters)
makeButton("DISABLE SOUNDS\n(Táº¯t Ã¢m thanh)",0.62,disableSounds)
makeButton("HIDE PLAYERS\n(áº¨n player)",0.72,hidePlayers)

---------------------------------------------------
-- SERVER TAB
---------------------------------------------------
makeButton("FIND LOW SERVER\n(Server Ã­t ngÆ°á»i)",0.82,findLowServer)

---------------------------------------------------
-- MINIMIZE
---------------------------------------------------
local icon = Instance.new("TextButton", gui)
icon.Text = "ðŸ¥¼ðŸ‘“"
icon.Size = UDim2.fromScale(0.12,0.08)
icon.Position = UDim2.fromScale(0.02,0.45)
icon.Visible = false
icon.TextScaled = true
icon.Active = true
icon.Draggable = true
Instance.new("UICorner", icon).CornerRadius = UDim.new(1,0)

local min = Instance.new("TextButton", main)
min.Text = "â€”"
min.Size = UDim2.fromScale(0.1,0.08)
min.Position = UDim2.fromScale(0.88,0.02)

min.MouseButton1Click:Connect(function()
    main.Visible = false
    icon.Visible = true
end)

icon.MouseButton1Click:Connect(function()
    main.Visible = true
    icon.Visible = false
end)
