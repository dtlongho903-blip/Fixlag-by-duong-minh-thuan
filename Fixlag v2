--==================================================
-- MINH THUáº¬N HUB | AIRHUB STYLE | UNIVERSAL
-- MAIN TAB + SERVER TAB | TOGGLE FEATURES
--==================================================

local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")
local RunService = game:GetService("RunService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer

--------------------------------------------------
-- STATES
--------------------------------------------------
local State = {
    FX = false,
    Shake = false,
    Debris = false,
    Gray = false,
    Sound = false,
    Hide = false
}

--------------------------------------------------
-- SAFE FUNCTIONS
--------------------------------------------------
local function toggleFX(on)
    for _,v in ipairs(Lighting:GetChildren()) do
        if v:IsA("PostEffect") then
            v.Enabled = not on
        end
    end
    for _,v in ipairs(workspace:GetDescendants()) do
        if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam") then
            v.Enabled = not on
        end
    end
end

local shakeConn
local function toggleShake(on)
    if on then
        shakeConn = RunService.RenderStepped:Connect(function()
            workspace.CurrentCamera.CFrame = workspace.CurrentCamera.CFrame
        end)
    elseif shakeConn then
        shakeConn:Disconnect()
    end
end

local function toggleDebris(on)
    if on then
        for _,p in ipairs(workspace:GetChildren()) do
            if p:IsA("Part") and not p.Anchored and not p.CanCollide then
                p:Destroy()
            end
        end
    end
end

local function toggleGray(on)
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr.Character then
            for _,v in ipairs(plr.Character:GetDescendants()) do
                if v:IsA("BasePart") then
                    if on then
                        v.Material = Enum.Material.SmoothPlastic
                        v.Color = Color3.fromRGB(150,150,150)
                    end
                end
                if v:IsA("Decal") or v:IsA("Texture") then
                    v.Transparency = on and 1 or 0
                end
            end
        end
    end
end

local function toggleSound(on)
    for _,s in ipairs(workspace:GetDescendants()) do
        if s:IsA("Sound") then
            s.Volume = on and 0 or 1
            if on then s:Stop() end
        end
    end
end

local function toggleHide(on)
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character then
            for _,v in ipairs(plr.Character:GetDescendants()) do
                if v:IsA("BasePart") then
                    v.LocalTransparencyModifier = on and 1 or 0
                end
            end
        end
    end
end

--------------------------------------------------
-- SERVER
--------------------------------------------------
local function findLowServer()
    local placeId = game.PlaceId
    local data = HttpService:JSONDecode(
        game:HttpGet("https://games.roblox.com/v1/games/"..placeId.."/servers/Public?sortOrder=Asc&limit=100")
    )
    for _,s in ipairs(data.data) do
        if s.playing < s.maxPlayers - 5 then
            TeleportService:TeleportToPlaceInstance(placeId, s.id, LocalPlayer)
            break
        end
    end
end

local function rejoin()
    TeleportService:Teleport(game.PlaceId, LocalPlayer)
end

--------------------------------------------------
-- GUI
--------------------------------------------------
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.ResetOnSpawn = false

local main = Instance.new("Frame", gui)
main.Size = UDim2.fromScale(0.85,0.6)
main.Position = UDim2.fromScale(0.075,0.2)
main.BackgroundColor3 = Color3.fromRGB(45,15,70)
main.Active = true
main.Draggable = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0,16)

local title = Instance.new("TextLabel", main)
title.Size = UDim2.fromScale(1,0.1)
title.Text = "MINH THUáº¬N HUB"
title.TextScaled = true
title.Font = Enum.Font.GothamBold
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(230,200,255)

--------------------------------------------------
-- TAB BUTTONS
--------------------------------------------------
local tabMain = Instance.new("TextButton", main)
tabMain.Text = "MAIN"
tabMain.Size = UDim2.fromScale(0.45,0.08)
tabMain.Position = UDim2.fromScale(0.05,0.12)

local tabServer = Instance.new("TextButton", main)
tabServer.Text = "SERVER"
tabServer.Size = UDim2.fromScale(0.45,0.08)
tabServer.Position = UDim2.fromScale(0.5,0.12)

for _,b in ipairs({tabMain, tabServer}) do
    b.TextScaled = true
    b.BackgroundColor3 = Color3.fromRGB(70,30,120)
    b.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,12)
end

--------------------------------------------------
-- CONTAINERS
--------------------------------------------------
local mainTab = Instance.new("Frame", main)
mainTab.Position = UDim2.fromScale(0,0.22)
mainTab.Size = UDim2.fromScale(1,0.68)
mainTab.BackgroundTransparency = 1

local serverTab = mainTab:Clone()
serverTab.Parent = main
serverTab.Visible = false

--------------------------------------------------
-- TOGGLE MAKER
--------------------------------------------------
local function makeToggle(parent, text, y, stateName, func)
    local btn = Instance.new("TextButton", parent)
    btn.Position = UDim2.fromScale(0.05,y)
    btn.Size = UDim2.fromScale(0.9,0.12)
    btn.TextScaled = true
    btn.Font = Enum.Font.Gotham
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,12)

    local function refresh()
        btn.Text = text.."\n"..(State[stateName] and "ON" or "OFF")
        btn.BackgroundColor3 = State[stateName] and Color3.fromRGB(120,60,180)
            or Color3.fromRGB(70,30,120)
    end

    btn.MouseButton1Click:Connect(function()
        State[stateName] = not State[stateName]
        func(State[stateName])
        refresh()
    end)

    refresh()
end

--------------------------------------------------
-- MAIN TAB TOGGLES
--------------------------------------------------
makeToggle(mainTab,"REMOVE EFFECTS\n(XÃ³a hiá»‡u á»©ng)",0.05,"FX",toggleFX)
makeToggle(mainTab,"CAMERA SHAKE\n(Táº¯t rung)",0.20,"Shake",toggleShake)
makeToggle(mainTab,"REMOVE DEBRIS\n(XÃ³a part rÆ¡i)",0.35,"Debris",toggleDebris)
makeToggle(mainTab,"GRAY MODE\n(NhÃ¢n váº­t xÃ¡m)",0.50,"Gray",toggleGray)
makeToggle(mainTab,"DISABLE SOUND\n(Táº¯t Ã¢m thanh)",0.65,"Sound",toggleSound)
makeToggle(mainTab,"HIDE PLAYERS\n(áº¨n player)",0.80,"Hide",toggleHide)

--------------------------------------------------
-- SERVER TAB
--------------------------------------------------
local function serverButton(text,y,callback)
    local b = Instance.new("TextButton", serverTab)
    b.Position = UDim2.fromScale(0.05,y)
    b.Size = UDim2.fromScale(0.9,0.15)
    b.Text = text
    b.TextScaled = true
    b.Font = Enum.Font.Gotham
    b.BackgroundColor3 = Color3.fromRGB(70,30,120)
    b.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,12)
    b.MouseButton1Click:Connect(callback)
end

serverButton("FIND LOW SERVER\n(Server Ã­t ngÆ°á»i)",0.15,findLowServer)
serverButton("REJOIN SERVER\n(VÃ o láº¡i server)",0.40,rejoin)

--------------------------------------------------
-- TAB SWITCH
--------------------------------------------------
tabMain.MouseButton1Click:Connect(function()
    mainTab.Visible = true
    serverTab.Visible = false
end)

tabServer.MouseButton1Click:Connect(function()
    mainTab.Visible = false
    serverTab.Visible = true
end)

--------------------------------------------------
-- MINIMIZE
--------------------------------------------------
local icon = Instance.new("TextButton", gui)
icon.Text = "ðŸ¥¼ðŸ‘“"
icon.Size = UDim2.fromScale(0.12,0.08)
icon.Position = UDim2.fromScale(0.02,0.45)
icon.TextScaled = true
icon.Visible = false
icon.Active = true
icon.Draggable = true
Instance.new("UICorner", icon).CornerRadius = UDim.new(1,0)

local min = Instance.new("TextButton", main)
min.Text = "â€”"
min.Size = UDim2.fromScale(0.1,0.08)
min.Position = UDim2.fromScale(0.88,0.02)

min.MouseButton1Click:Connect(function()
    main.Visible = false
    icon.Visible = true
end)

icon.MouseButton1Click:Connect(function()
    main.Visible = true
    icon.Visible = false
end)
