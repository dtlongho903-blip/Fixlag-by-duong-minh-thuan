--==========================================================
-- MINH THU·∫¨N ULTIMATE HUB | FIX LAG + HACK + HITBOX EXPANDER
--==========================================================
-- Developer: D∆∞∆°ng Minh Thu·∫≠n
-- Version: 3.3 Ultimate Fixed Edition
-- Fix: Ho√†n to√†n l·ªói thanh k√©o

if getgenv().MINHTHUAN_ULTIMATE then return end
getgenv().MINHTHUAN_ULTIMATE = true

---------------- SERVICES ----------------
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local TeleportService = game:GetService("TeleportService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer

---------------- CONFIGURATION ----------------
local CONFIG = {
    ThemeColor = Color3.fromRGB(80, 40, 130),
    DarkColor = Color3.fromRGB(45, 20, 70),
    LightColor = Color3.fromRGB(90, 50, 140),
    TextColor = Color3.fromRGB(255, 255, 255),
    ShadowColor = Color3.fromRGB(0, 0, 0),
    Font = Enum.Font.GothamSemibold,
    TitleFont = Enum.Font.GothamBold
}

---------------- STATE ----------------
local STATE = {
    -- Fix Lag States
    FX = false,
    SOUND = false,
    SHADOW = false,
    LOWGFX = false,
    TEXTURES = false,
    POSTFX = false,
    GRAYCHARS = false,
    
    -- Hack States
    NOCLIP = false,
    SPEED = false,
    SPEED_VALUE = 50,
    JUMP = false,
    JUMP_VALUE = 100,
    FLY = false,
    FLY_VALUE = 50,
    INFJUMP = false,
    ESP = false,
    
    -- Hitbox States
    HITBOX_ENABLED = false,
    HITBOX_SIZE = 6,
    HITBOX_TRANSPARENCY = 0.5,
    TOOL_HITBOX_ENABLED = false,
    TOOL_HITBOX_SIZE = 10,
    
    -- GUI States
    GUI_VISIBLE = true,
    MINIMIZED = false
}

---------------- HITBOX VARIABLES ----------------
local hitboxParts = {}
local toolHitbox = nil
local hitboxConnections = {}
local noclipConnection = nil
local flyConnection = nil
local flyBodyVel = nil
local jumpConnection = nil
local espHighlights = {}

---------------- GUI PARENT ----------------
local parent = game:GetService("CoreGui") or player:WaitForChild("PlayerGui")

---------------- UTILITY FUNCTIONS ----------------
local function createShadow(parent, size)
    local shadow = Instance.new("ImageLabel")
    shadow.Name = "Shadow"
    shadow.Image = "rbxassetid://1316045217"
    shadow.ImageColor3 = CONFIG.ShadowColor
    shadow.ImageTransparency = 0.8
    shadow.ScaleType = Enum.ScaleType.Slice
    shadow.SliceCenter = Rect.new(10, 10, 118, 118)
    shadow.BackgroundTransparency = 1
    shadow.Size = size
    shadow.Position = UDim2.new(0, -15, 0, -15)
    shadow.ZIndex = parent.ZIndex - 1
    shadow.Parent = parent
    return shadow
end

local function tweenProperty(instance, property, goal, duration)
    local tweenInfo = TweenInfo.new(duration, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(instance, tweenInfo, {[property] = goal})
    tween:Play()
    return tween
end

---------------- HITBOX FUNCTIONS ----------------
local function createHitboxPart(character, size, transparency)
    if not character or not character.PrimaryPart then return nil end
    
    local hitbox = Instance.new("Part")
    hitbox.Name = "HitboxExpander"
    hitbox.Size = Vector3.new(size, size, size)
    hitbox.Transparency = transparency
    hitbox.CanCollide = false
    hitbox.CanTouch = false
    hitbox.CanQuery = false
    hitbox.Anchored = false
    hitbox.Material = Enum.Material.Neon
    hitbox.Color = Color3.fromRGB(255, 50, 50)
    hitbox.Parent = character
    
    local weld = Instance.new("Weld")
    weld.Part0 = character.PrimaryPart
    weld.Part1 = hitbox
    weld.C0 = CFrame.new()
    weld.Parent = hitbox
    
    return hitbox
end

local function updateAllHitboxes()
    for _, hitbox in pairs(hitboxParts) do
        if hitbox and hitbox.Parent then
            hitbox:Destroy()
        end
    end
    hitboxParts = {}
    
    if not STATE.HITBOX_ENABLED then return end
    
    for _, model in pairs(workspace:GetChildren()) do
        if model:IsA("Model") then
            local humanoid = model:FindFirstChildOfClass("Humanoid")
            if humanoid and model ~= player.Character then
                local hitbox = createHitboxPart(model, STATE.HITBOX_SIZE, STATE.HITBOX_TRANSPARENCY)
                if hitbox then
                    table.insert(hitboxParts, hitbox)
                end
            end
        end
    end
end

local function updateToolHitbox()
    if toolHitbox and toolHitbox.Parent then
        toolHitbox:Destroy()
        toolHitbox = nil
    end
    
    if not STATE.TOOL_HITBOX_ENABLED then return end
    
    local character = player.Character
    if not character then return end
    
    local tool = character:FindFirstChildOfClass("Tool")
    if not tool then return end
    
    local handle = tool:FindFirstChild("Handle")
    if not handle then return end
    
    toolHitbox = Instance.new("Part")
    toolHitbox.Name = "ToolHitbox"
    toolHitbox.Size = Vector3.new(STATE.TOOL_HITBOX_SIZE, STATE.TOOL_HITBOX_SIZE, STATE.TOOL_HITBOX_SIZE)
    toolHitbox.Transparency = 0.5
    toolHitbox.CanCollide = false
    toolHitbox.CanTouch = false
    toolHitbox.CanQuery = false
    toolHitbox.Anchored = false
    toolHitbox.Material = Enum.Material.Neon
    toolHitbox.Color = Color3.fromRGB(50, 255, 50)
    toolHitbox.Parent = tool
    
    local weld = Instance.new("Weld")
    weld.Part0 = handle
    weld.Part1 = toolHitbox
    weld.C0 = CFrame.new()
    weld.Parent = toolHitbox
end

---------------- CREATE GUI ----------------
local gui = Instance.new("ScreenGui", parent)
gui.Name = "MinhThuanUltimateHub"
gui.ZIndexBehavior = Enum.ZIndexBehavior.Global
gui.ResetOnSpawn = false

---------------- MAIN CONTAINER ----------------
local mainContainer = Instance.new("Frame", gui)
mainContainer.Name = "MainContainer"
mainContainer.Size = UDim2.new(0, 450, 0, 600)
mainContainer.Position = UDim2.new(0.5, -225, 0.5, -300)
mainContainer.BackgroundColor3 = CONFIG.DarkColor
mainContainer.BackgroundTransparency = 0.05
mainContainer.BorderSizePixel = 0
mainContainer.ClipsDescendants = true
mainContainer.Active = true
mainContainer.Draggable = true
mainContainer.ZIndex = 50

createShadow(mainContainer, UDim2.new(1, 30, 1, 30))

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 16)
corner.Parent = mainContainer

---------------- TITLE BAR ----------------
local titleBar = Instance.new("Frame", mainContainer)
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 50)
titleBar.BackgroundColor3 = CONFIG.LightColor
titleBar.BorderSizePixel = 0
titleBar.ZIndex = 51

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 16, 0, 0)
titleCorner.Parent = titleBar

local title = Instance.new("TextLabel", titleBar)
title.Text = "üü£ MINH THU·∫¨N ULTIMATE HUB"
title.Size = UDim2.new(0.7, 0, 1, 0)
title.Position = UDim2.new(0.05, 0, 0, 0)
title.BackgroundTransparency = 1
title.TextColor3 = CONFIG.TextColor
title.Font = CONFIG.TitleFont
title.TextSize = 18
title.TextXAlignment = Enum.TextXAlignment.Left
title.ZIndex = 52

local subtitle = Instance.new("TextLabel", titleBar)
subtitle.Text = "Fix Lag + Hack + Hitbox Expander | V3.3 Ultimate"
subtitle.Size = UDim2.new(0.7, 0, 0, 20)
subtitle.Position = UDim2.new(0.05, 0, 0, 30)
subtitle.BackgroundTransparency = 1
subtitle.TextColor3 = Color3.fromRGB(220, 220, 220)
subtitle.Font = Enum.Font.Gotham
subtitle.TextSize = 12
subtitle.TextXAlignment = Enum.TextXAlignment.Left
subtitle.ZIndex = 52

---------------- TAB SYSTEM ----------------
local tabContainer = Instance.new("Frame", mainContainer)
tabContainer.Name = "TabContainer"
tabContainer.Size = UDim2.new(1, 0, 0, 40)
tabContainer.Position = UDim2.new(0, 0, 0, 55)
tabContainer.BackgroundColor3 = CONFIG.DarkColor
tabContainer.BorderSizePixel = 0
tabContainer.ZIndex = 51

local tabs = {"FIX LAG", "HACK", "SETTINGS"}
local currentTab = "FIX LAG"
local tabFrames = {}

local function createTabButton(text, index)
    local tabBtn = Instance.new("TextButton", tabContainer)
    tabBtn.Name = text .. "Tab"
    tabBtn.Size = UDim2.new(1/#tabs, 0, 1, 0)
    tabBtn.Position = UDim2.new((index-1)/#tabs, 0, 0, 0)
    tabBtn.BackgroundColor3 = CONFIG.DarkColor
    tabBtn.Text = text
    tabBtn.TextColor3 = CONFIG.TextColor
    tabBtn.Font = CONFIG.Font
    tabBtn.TextSize = 14
    tabBtn.ZIndex = 52
    tabBtn.AutoButtonColor = false
    
    local highlight = Instance.new("Frame")
    highlight.Name = "Highlight"
    highlight.Size = UDim2.new(1, 0, 0, 3)
    highlight.Position = UDim2.new(0, 0, 1, -3)
    highlight.BackgroundColor3 = CONFIG.ThemeColor
    highlight.BorderSizePixel = 0
    highlight.Visible = (text == currentTab)
    highlight.ZIndex = 53
    highlight.Parent = tabBtn
    
    tabBtn.MouseButton1Click:Connect(function()
        currentTab = text
        for frameName, frame in pairs(tabFrames) do
            frame.Visible = (frameName == text)
        end
        for _, btn in ipairs(tabContainer:GetChildren()) do
            if btn:IsA("TextButton") then
                btn.Highlight.Visible = (btn.Text == text)
                tweenProperty(btn, "BackgroundColor3", 
                    btn.Text == text and Color3.fromRGB(70, 35, 110) or CONFIG.DarkColor, 0.2)
            end
        end
    end)
    
    return tabBtn
end

for i, tabName in ipairs(tabs) do
    createTabButton(tabName, i)
end

---------------- SCROLL FRAME CREATOR ----------------
local function createScrollFrame(parentFrame, visible)
    local scrollFrame = Instance.new("ScrollingFrame", parentFrame)
    scrollFrame.Name = parentFrame.Name .. "Scroll"
    scrollFrame.Size = UDim2.new(1, -20, 1, -145)
    scrollFrame.Position = UDim2.new(0, 10, 0, 105)
    scrollFrame.BackgroundTransparency = 1
    scrollFrame.BorderSizePixel = 0
    scrollFrame.ScrollBarThickness = 8
    scrollFrame.ScrollBarImageColor3 = CONFIG.ThemeColor
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    scrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
    scrollFrame.ScrollingEnabled = true
    scrollFrame.ScrollingDirection = Enum.ScrollingDirection.Y
    scrollFrame.Visible = visible
    scrollFrame.ZIndex = 50
    
    local layout = Instance.new("UIListLayout", scrollFrame)
    layout.Padding = UDim.new(0, 10)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    
    layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        scrollFrame.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 10)
    end)
    
    return scrollFrame
end

local fixLagFrame = createScrollFrame(mainContainer, true)
fixLagFrame.Name = "FIX LAG"
tabFrames["FIX LAG"] = fixLagFrame

local hackFrame = createScrollFrame(mainContainer, false)
hackFrame.Name = "HACK"
tabFrames["HACK"] = hackFrame

local settingsFrame = Instance.new("Frame", mainContainer)
settingsFrame.Name = "SETTINGS"
settingsFrame.Size = UDim2.new(1, -20, 1, -145)
settingsFrame.Position = UDim2.new(0, 10, 0, 105)
settingsFrame.BackgroundTransparency = 1
settingsFrame.Visible = false
settingsFrame.ZIndex = 50
tabFrames["SETTINGS"] = settingsFrame

---------------- MINIMIZED VIEW ----------------
local minimizedView = Instance.new("Frame", gui)
minimizedView.Name = "MinimizedView"
minimizedView.Size = UDim2.new(0, 250, 0, 40)
minimizedView.Position = UDim2.new(0.5, -125, 0, 10)
minimizedView.BackgroundColor3 = CONFIG.DarkColor
minimizedView.BackgroundTransparency = 0.05
minimizedView.BorderSizePixel = 0
minimizedView.Visible = false
minimizedView.ZIndex = 50
minimizedView.Active = true
minimizedView.Draggable = true

createShadow(minimizedView, UDim2.new(1, 30, 1, 30))

local miniCorner = Instance.new("UICorner")
miniCorner.CornerRadius = UDim.new(0, 12)
miniCorner.Parent = minimizedView

local miniTitle = Instance.new("TextLabel", minimizedView)
miniTitle.Size = UDim2.new(0.7, 0, 1, 0)
miniTitle.Position = UDim2.new(0.05, 0, 0, 0)
miniTitle.BackgroundTransparency = 1
miniTitle.Text = "üü£ Minh Thu·∫≠n Hub (Minimized)"
miniTitle.TextColor3 = CONFIG.TextColor
miniTitle.Font = CONFIG.TitleFont
miniTitle.TextSize = 14
miniTitle.TextXAlignment = Enum.TextXAlignment.Left
miniTitle.ZIndex = 51

local expandBtn = Instance.new("TextButton", minimizedView)
expandBtn.Name = "Expand"
expandBtn.Size = UDim2.new(0, 30, 0, 30)
expandBtn.Position = UDim2.new(0.85, 0, 0.5, -15)
expandBtn.BackgroundColor3 = CONFIG.ThemeColor
expandBtn.Text = "+"
expandBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
expandBtn.Font = Enum.Font.GothamBold
expandBtn.TextSize = 20
expandBtn.ZIndex = 51

local expandCorner = Instance.new("UICorner")
expandCorner.CornerRadius = UDim.new(0, 6)
expandCorner.Parent = expandBtn

---------------- SIMPLE SLIDER CREATOR (FIXED) ----------------
local function createSlider(parent, labelText, minValue, maxValue, currentValue, callback)
    local sliderContainer = Instance.new("Frame", parent)
    sliderContainer.Name = labelText .. "Slider"
    sliderContainer.Size = UDim2.new(1, 0, 0, 70)
    sliderContainer.BackgroundTransparency = 1
    sliderContainer.ZIndex = 55
    
    -- Label
    local label = Instance.new("TextLabel", sliderContainer)
    label.Size = UDim2.new(1, -20, 0, 25)
    label.Position = UDim2.new(0, 10, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = labelText
    label.TextColor3 = CONFIG.TextColor
    label.Font = CONFIG.Font
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.ZIndex = 56
    
    -- Value Display
    local valueLabel = Instance.new("TextLabel", sliderContainer)
    valueLabel.Size = UDim2.new(0, 50, 0, 25)
    valueLabel.Position = UDim2.new(1, -60, 0, 0)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = tostring(currentValue)
    valueLabel.TextColor3 = CONFIG.ThemeColor
    valueLabel.Font = CONFIG.Font
    valueLabel.TextSize = 14
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.ZIndex = 56
    
    -- Slider Track
    local track = Instance.new("TextButton", sliderContainer) -- S·ª≠ d·ª•ng TextButton ƒë·ªÉ nh·∫≠n input
    track.Name = "Track"
    track.Size = UDim2.new(1, -20, 0, 20)
    track.Position = UDim2.new(0, 10, 0, 35)
    track.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    track.BorderSizePixel = 0
    track.Text = ""
    track.AutoButtonColor = false
    track.ZIndex = 56
    
    local trackCorner = Instance.new("UICorner", track)
    trackCorner.CornerRadius = UDim.new(1, 0)
    
    -- Slider Fill
    local fill = Instance.new("Frame", track)
    fill.Name = "Fill"
    fill.Size = UDim2.new((currentValue - minValue) / (maxValue - minValue), 0, 1, 0)
    fill.BackgroundColor3 = CONFIG.ThemeColor
    fill.BorderSizePixel = 0
    fill.ZIndex = 57
    
    local fillCorner = Instance.new("UICorner", fill)
    fillCorner.CornerRadius = UDim.new(1, 0)
    
    -- Slider Thumb
    local thumb = Instance.new("TextButton", track) -- S·ª≠ d·ª•ng TextButton ƒë·ªÉ nh·∫≠n input
    thumb.Name = "Thumb"
    thumb.Size = UDim2.new(0, 25, 0, 25)
    thumb.Position = UDim2.new((currentValue - minValue) / (maxValue - minValue), -12.5, 0.5, -12.5)
    thumb.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    thumb.BorderSizePixel = 0
    thumb.Text = ""
    thumb.AutoButtonColor = false
    thumb.ZIndex = 58
    
    local thumbCorner = Instance.new("UICorner", thumb)
    thumbCorner.CornerRadius = UDim.new(1, 0)
    
    -- DRAGGING LOGIC FIXED
    local dragging = false
    local connection1, connection2, connection3
    
    local function updateSliderFromMouse()
        if not track:IsDescendantOf(game) then return end
        
        local mouse = game:GetService("Players").LocalPlayer:GetMouse()
        local trackAbsPos = track.AbsolutePosition
        local trackAbsSize = track.AbsoluteSize
        
        local relativeX = (mouse.X - trackAbsPos.X) / trackAbsSize.X
        relativeX = math.clamp(relativeX, 0, 1)
        
        local value = minValue + (maxValue - minValue) * relativeX
        value = math.floor(value * 10) / 10
        
        fill.Size = UDim2.new(relativeX, 0, 1, 0)
        thumb.Position = UDim2.new(relativeX, -12.5, 0.5, -12.5)
        valueLabel.Text = tostring(value)
        
        if callback then
            callback(value)
        end
    end
    
    local function startDragging()
        dragging = true
        
        -- T·∫°o c√°c connections
        connection1 = game:GetService("RunService").RenderStepped:Connect(function()
            if dragging then
                updateSliderFromMouse()
            end
        end)
        
        connection2 = UIS.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                updateSliderFromMouse()
            end
        end)
        
        connection3 = UIS.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
                if connection1 then connection1:Disconnect() end
                if connection2 then connection2:Disconnect() end
                if connection3 then connection3:Disconnect() end
            end
        end)
    end
    
    -- Mouse down on track
    track.MouseButton1Down:Connect(function()
        updateSliderFromMouse()
        startDragging()
    end)
    
    -- Mouse down on thumb
    thumb.MouseButton1Down:Connect(function()
        startDragging()
    end)
    
    -- Mouse leave track (clean up if still dragging)
    track.MouseLeave:Connect(function()
        if not UIS:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) then
            dragging = false
            if connection1 then connection1:Disconnect() end
            if connection2 then connection2:Disconnect() end
            if connection3 then connection3:Disconnect() end
        end
    end)
    
    return sliderContainer
end

---------------- SECTION CREATOR ----------------
local function createSection(parent, text)
    local section = Instance.new("TextLabel", parent)
    section.Text = "‚ñ¨‚ñ¨‚ñ¨ " .. text .. " ‚ñ¨‚ñ¨‚ñ¨"
    section.Size = UDim2.new(1, 0, 0, 30)
    section.BackgroundTransparency = 1
    section.TextColor3 = CONFIG.ThemeColor
    section.Font = CONFIG.TitleFont
    section.TextSize = 14
    section.ZIndex = 55
    
    return section
end

---------------- FIX LAG FEATURES ----------------
local function clearFX()
    for _, v in ipairs(workspace:GetDescendants()) do
        if v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam") or v:IsA("Fire") or v:IsA("Smoke") or v:IsA("Sparkles") then
            v.Enabled = false
        end
    end
end

local function disableSounds()
    for _, s in ipairs(workspace:GetDescendants()) do
        if s:IsA("Sound") then
            s.Volume = 0
            s.Playing = false
        end
    end
end

local function lowGraphicsMode()
    settings().Rendering.QualityLevel = 1
    for _, v in ipairs(workspace:GetDescendants()) do
        if v:IsA("BasePart") then
            v.Material = Enum.Material.Plastic
            v.Reflectance = 0
        end
    end
end

local function removeTextures()
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("Decal") or obj:IsA("Texture") then
            obj.Transparency = 1
        end
    end
end

local function disablePostEffects()
    for _, effect in ipairs(Lighting:GetChildren()) do
        if effect:IsA("BlurEffect") or effect:IsA("BloomEffect") or effect:IsA("ColorCorrectionEffect") then
            effect.Enabled = false
        end
    end
end

local function grayCharacters()
    for _, model in ipairs(workspace:GetChildren()) do
        if model:IsA("Model") then
            local humanoid = model:FindFirstChildOfClass("Humanoid")
            if humanoid then
                for _, part in ipairs(model:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.Color = Color3.fromRGB(150, 150, 150)
                        part.Material = Enum.Material.Plastic
                    end
                end
            end
        end
    end
end

-- Master Fix Button
local masterFixBtn = Instance.new("TextButton", fixLagFrame)
masterFixBtn.Text = "‚ö° MASTER FIX ALL ‚ö°"
masterFixBtn.Size = UDim2.new(1, 0, 0, 50)
masterFixBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
masterFixBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
masterFixBtn.Font = Enum.Font.GothamBold
masterFixBtn.TextSize = 16
masterFixBtn.ZIndex = 55

local masterCorner = Instance.new("UICorner", masterFixBtn)
masterCorner.CornerRadius = UDim.new(0, 10)

masterFixBtn.MouseButton1Click:Connect(function()
    clearFX()
    disableSounds()
    Lighting.GlobalShadows = false
    lowGraphicsMode()
    removeTextures()
    disablePostEffects()
    grayCharacters()
    
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "MASTER FIX",
        Text = "ƒê√£ √°p d·ª•ng t·∫•t c·∫£ t√≠nh nƒÉng fix lag!",
        Duration = 3,
        Icon = "rbxassetid://6723928013"
    })
end)

-- Fix Lag Buttons
local fixButtons = {
    {"‚ùå", "DISABLE EFFECTS", "T·∫Øt particle, l·ª≠a, kh√≥i, hi·ªáu ·ª©ng", function()
        clearFX()
    end},
    {"üîá", "DISABLE SOUNDS", "T·∫Øt to√†n b·ªô √¢m thanh trong game", function()
        disableSounds()
    end},
    {"üåë", "DISABLE SHADOWS", "T·∫Øt b√≥ng ƒë·ªï to√†n c·ª•c", function()
        Lighting.GlobalShadows = false
    end},
    {"üìâ", "LOW GRAPHICS", "Gi·∫£m ch·∫•t l∆∞·ª£ng ƒë·ªì h·ªça t·ªëi ƒëa", function()
        lowGraphicsMode()
    end},
    {"üñºÔ∏è", "REMOVE TEXTURES", "X√≥a texture v√† decal", function()
        removeTextures()
    end},
    {"üåà", "REMOVE POST FX", "T·∫Øt bloom, blur, √°nh s√°ng h·∫≠u k·ª≥", function()
        disablePostEffects()
    end},
    {"üë§", "GRAY CHARACTERS", "Bi·∫øn nh√¢n v·∫≠t th√†nh m√†u x√°m", function()
        grayCharacters()
    end}
}

for _, btnData in ipairs(fixButtons) do
    local btn = Instance.new("TextButton", fixLagFrame)
    btn.Text = btnData[1] .. " " .. btnData[2]
    btn.Size = UDim2.new(1, 0, 0, 50)
    btn.BackgroundColor3 = CONFIG.LightColor
    btn.TextColor3 = CONFIG.TextColor
    btn.Font = CONFIG.Font
    btn.TextSize = 14
    btn.ZIndex = 55
    
    local btnCorner = Instance.new("UICorner", btn)
    btnCorner.CornerRadius = UDim.new(0, 10)
    
    local desc = Instance.new("TextLabel", btn)
    desc.Text = btnData[3]
    desc.Size = UDim2.new(1, -20, 0, 20)
    desc.Position = UDim2.new(0, 10, 0, 30)
    desc.BackgroundTransparency = 1
    desc.TextColor3 = Color3.fromRGB(200, 200, 200)
    desc.Font = Enum.Font.Gotham
    desc.TextSize = 11
    desc.TextXAlignment = Enum.TextXAlignment.Left
    
    btn.MouseButton1Click:Connect(btnData[4])
end

---------------- HACK FEATURES ----------------
-- Setup functions
local function setupNoclip()
    if noclipConnection then
        noclipConnection:Disconnect()
    end
    noclipConnection = RunService.Stepped:Connect(function()
        if player.Character then
            for _, part in ipairs(player.Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end
    end)
end

local function removeNoclip()
    if noclipConnection then
        noclipConnection:Disconnect()
        noclipConnection = nil
    end
    if player.Character then
        for _, part in ipairs(player.Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = true
            end
        end
    end
end

local function setSpeed(value)
    if player.Character then
        local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = value
        end
    end
end

local function setJump(value)
    if player.Character then
        local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.JumpPower = value
        end
    end
end

local function setupFly()
    if flyConnection then
        flyConnection:Disconnect()
    end
    if flyBodyVel then
        flyBodyVel:Destroy()
        flyBodyVel = nil
    end
    
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        flyBodyVel = Instance.new("BodyVelocity")
        flyBodyVel.Velocity = Vector3.new(0, 0, 0)
        flyBodyVel.MaxForce = Vector3.new(40000, 40000, 40000)
        flyBodyVel.Parent = player.Character.HumanoidRootPart
        
        flyConnection = RunService.Heartbeat:Connect(function()
            if not flyBodyVel then return end
            
            local velocity = Vector3.new(0, 0, 0)
            local cam = workspace.CurrentCamera
            
            if UIS:IsKeyDown(Enum.KeyCode.W) then
                velocity = velocity + (cam.CFrame.LookVector * STATE.FLY_VALUE)
            end
            if UIS:IsKeyDown(Enum.KeyCode.S) then
                velocity = velocity - (cam.CFrame.LookVector * STATE.FLY_VALUE)
            end
            if UIS:IsKeyDown(Enum.KeyCode.A) then
                velocity = velocity - (cam.CFrame.RightVector * STATE.FLY_VALUE)
            end
            if UIS:IsKeyDown(Enum.KeyCode.D) then
                velocity = velocity + (cam.CFrame.RightVector * STATE.FLY_VALUE)
            end
            if UIS:IsKeyDown(Enum.KeyCode.Space) then
                velocity = velocity + Vector3.new(0, STATE.FLY_VALUE, 0)
            end
            if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then
                velocity = velocity - Vector3.new(0, STATE.FLY_VALUE, 0)
            end
            
            flyBodyVel.Velocity = velocity
        end)
    end
end

local function removeFly()
    if flyConnection then
        flyConnection:Disconnect()
        flyConnection = nil
    end
    if flyBodyVel then
        flyBodyVel:Destroy()
        flyBodyVel = nil
    end
end

local function setupESP()
    for _, highlight in pairs(espHighlights) do
        if highlight and highlight.Parent then
            highlight:Destroy()
        end
    end
    espHighlights = {}
    
    local function createESP(character)
        if character == player.Character then return end
        
        local highlight = Instance.new("Highlight")
        highlight.Name = "ESP_Highlight"
        highlight.FillColor = Color3.fromRGB(255, 0, 0)
        highlight.FillTransparency = 0.7
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        highlight.OutlineTransparency = 0
        highlight.Parent = character
        
        table.insert(espHighlights, highlight)
    end
    
    for _, p in ipairs(Players:GetPlayers()) do
        if p.Character then
            createESP(p.Character)
        end
        p.CharacterAdded:Connect(createESP)
    end
end

-- Section HITBOX
createSection(hackFrame, "HITBOX EXPANDER")

-- Hitbox Size Slider
createSlider(hackFrame, "Hitbox Size (1-20)", 1, 20, STATE.HITBOX_SIZE, function(value)
    STATE.HITBOX_SIZE = value
    for _, hitbox in pairs(hitboxParts) do
        if hitbox and hitbox.Parent then
            hitbox.Size = Vector3.new(value, value, value)
        end
    end
end)

-- Hitbox Transparency Slider
createSlider(hackFrame, "Hitbox Transparency (0-1)", 0, 1, STATE.HITBOX_TRANSPARENCY, function(value)
    STATE.HITBOX_TRANSPARENCY = value
    for _, hitbox in pairs(hitboxParts) do
        if hitbox and hitbox.Parent then
            hitbox.Transparency = value
        end
    end
end)

-- Tool Hitbox Size Slider
createSlider(hackFrame, "Tool Hitbox Size (1-50)", 1, 50, STATE.TOOL_HITBOX_SIZE, function(value)
    STATE.TOOL_HITBOX_SIZE = value
    if toolHitbox and toolHitbox.Parent then
        toolHitbox.Size = Vector3.new(value, value, value)
    end
end)

-- Section MOVEMENT HACKS
createSection(hackFrame, "MOVEMENT HACKS")

-- Speed Hack Slider
createSlider(hackFrame, "Speed Value (16-150)", 16, 150, STATE.SPEED_VALUE, function(value)
    STATE.SPEED_VALUE = value
    setSpeed(value)
end)

-- Jump Hack Slider
createSlider(hackFrame, "Jump Power (50-500)", 50, 500, STATE.JUMP_VALUE, function(value)
    STATE.JUMP_VALUE = value
    setJump(value)
end)

-- Fly Speed Slider
createSlider(hackFrame, "Fly Speed (20-200)", 20, 200, STATE.FLY_VALUE, function(value)
    STATE.FLY_VALUE = value
    if flyBodyVel then
        setupFly()
    end
end)

-- Hack Buttons
local hackButtons = {
    {"üéØ", "PLAYER HITBOX", "M·ªü r·ªông hitbox ng∆∞·ªùi ch∆°i & NPC", function()
        STATE.HITBOX_ENABLED = not STATE.HITBOX_ENABLED
        if STATE.HITBOX_ENABLED then
            updateAllHitboxes()
        else
            for _, hitbox in pairs(hitboxParts) do
                if hitbox and hitbox.Parent then
                    hitbox:Destroy()
                end
            end
            hitboxParts = {}
        end
    end},
    {"üîß", "TOOL HITBOX", "M·ªü r·ªông hitbox tool ƒëang c·∫ßm", function()
        STATE.TOOL_HITBOX_ENABLED = not STATE.TOOL_HITBOX_ENABLED
        updateToolHitbox()
    end},
    {"üëª", "NOCLIP", "ƒêi xuy√™n qua t∆∞·ªùng", function()
        STATE.NOCLIP = not STATE.NOCLIP
        if STATE.NOCLIP then
            setupNoclip()
        else
            removeNoclip()
        end
    end},
    {"üïäÔ∏è", "FLY HACK", "Bay l∆∞·ª£n t·ª± do", function()
        STATE.FLY = not STATE.FLY
        if STATE.FLY then
            setupFly()
        else
            removeFly()
        end
    end},
    {"üëÅÔ∏è", "PLAYER ESP", "Hi·ªán v·ªã tr√≠ ng∆∞·ªùi ch∆°i kh√°c", function()
        STATE.ESP = not STATE.ESP
        if STATE.ESP then
            setupESP()
        else
            for _, highlight in pairs(espHighlights) do
                if highlight and highlight.Parent then
                    highlight:Destroy()
                end
            end
            espHighlights = {}
        end
    end}
}

for _, btnData in ipairs(hackButtons) do
    local btn = Instance.new("TextButton", hackFrame)
    btn.Text = btnData[1] .. " " .. btnData[2]
    btn.Size = UDim2.new(1, 0, 0, 50)
    btn.BackgroundColor3 = CONFIG.LightColor
    btn.TextColor3 = CONFIG.TextColor
    btn.Font = CONFIG.Font
    btn.TextSize = 14
    btn.ZIndex = 55
    
    local btnCorner = Instance.new("UICorner", btn)
    btnCorner.CornerRadius = UDim.new(0, 10)
    
    local desc = Instance.new("TextLabel", btn)
    desc.Text = btnData[3]
    desc.Size = UDim2.new(1, -20, 0, 20)
    desc.Position = UDim2.new(0, 10, 0, 30)
    desc.BackgroundTransparency = 1
    desc.TextColor3 = Color3.fromRGB(200, 200, 200)
    desc.Font = Enum.Font.Gotham
    desc.TextSize = 11
    desc.TextXAlignment = Enum.TextXAlignment.Left
    
    btn.MouseButton1Click:Connect(btnData[4])
end

-- Master Hack Button
local masterHackBtn = Instance.new("TextButton", hackFrame)
masterHackBtn.Text = "üí• MASTER HACK ALL üí•"
masterHackBtn.Size = UDim2.new(1, 0, 0, 50)
masterHackBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
masterHackBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
masterHackBtn.Font = Enum.Font.GothamBold
masterHackBtn.TextSize = 16
masterHackBtn.ZIndex = 55

local masterHackCorner = Instance.new("UICorner", masterHackBtn)
masterHackCorner.CornerRadius = UDim.new(0, 10)

masterHackBtn.MouseButton1Click:Connect(function()
    STATE.HITBOX_ENABLED = true
    STATE.TOOL_HITBOX_ENABLED = true
    STATE.NOCLIP = true
    STATE.FLY = true
    STATE.ESP = true
    
    setSpeed(STATE.SPEED_VALUE)
    setJump(STATE.JUMP_VALUE)
    
    updateAllHitboxes()
    updateToolHitbox()
    setupNoclip()
    setupFly()
    setupESP()
    
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "MASTER HACK",
        Text = "ƒê√£ k√≠ch ho·∫°t to√†n b·ªô hack!",
        Duration = 3,
        Icon = "rbxassetid://6723928013"
    })
end)

---------------- SETTINGS TAB ----------------
local settingsHeader = Instance.new("TextLabel", settingsFrame)
settingsHeader.Text = "‚öôÔ∏è GUI SETTINGS"
settingsHeader.Size = UDim2.new(1, 0, 0, 30)
settingsHeader.BackgroundTransparency = 1
settingsHeader.TextColor3 = CONFIG.ThemeColor
settingsHeader.Font = CONFIG.TitleFont
settingsHeader.TextSize = 18
settingsHeader.TextXAlignment = Enum.TextXAlignment.Left
settingsHeader.ZIndex = 55
settingsHeader.Position = UDim2.new(0, 0, 0, 0)

-- GUI Opacity Slider
local opacitySlider = createSlider(settingsFrame, "GUI Opacity (0.1-1)", 0.1, 1, 0.95, function(value)
    mainContainer.BackgroundTransparency = 1 - value
    minimizedView.BackgroundTransparency = 1 - value
end)
opacitySlider.Position = UDim2.new(0, 0, 0, 40)

-- Join New Server Button
local newServerBtn = Instance.new("TextButton", settingsFrame)
newServerBtn.Text = "üîÑ JOIN NEW SERVER"
newServerBtn.Size = UDim2.new(1, 0, 0, 50)
newServerBtn.Position = UDim2.new(0, 0, 0, 120)
newServerBtn.BackgroundColor3 = Color3.fromRGB(100, 60, 160)
newServerBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
newServerBtn.Font = Enum.Font.GothamBold
newServerBtn.TextSize = 14
newServerBtn.ZIndex = 55

local serverCorner = Instance.new("UICorner", newServerBtn)
serverCorner.CornerRadius = UDim.new(0, 10)

newServerBtn.MouseButton1Click:Connect(function()
    TeleportService:Teleport(game.PlaceId, player)
end)

---------------- GUI CONTROLS ----------------
local draggingGui, dragInput, dragStart, startPos

titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingGui = true
        dragStart = input.Position
        startPos = mainContainer.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                draggingGui = false
            end
        end)
    end
end)

titleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UIS.InputChanged:Connect(function(input)
    if draggingGui and input == dragInput then
        local delta = input.Position - dragStart
        mainContainer.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

minimizeBtn.MouseButton1Click:Connect(function()
    STATE.MINIMIZED = not STATE.MINIMIZED
    
    if STATE.MINIMIZED then
        minimizedView.Visible = true
        mainContainer.Visible = false
    else
        minimizedView.Visible = false
        mainContainer.Visible = true
    end
end)

expandBtn.MouseButton1Click:Connect(function()
    STATE.MINIMIZED = false
    minimizedView.Visible = false
    mainContainer.Visible = true
end)

---------------- KEYBINDS ----------------
UIS.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed then
        if input.KeyCode == Enum.KeyCode.F9 then
            mainContainer.Visible = not mainContainer.Visible
            minimizedView.Visible = not mainContainer.Visible
        elseif input.KeyCode == Enum.KeyCode.F10 then
            currentTab = "HACK"
            for frameName, frame in pairs(tabFrames) do
                frame.Visible = (frameName == currentTab)
            end
            for _, btn in ipairs(tabContainer:GetChildren()) do
                if btn:IsA("TextButton") then
                    btn.Highlight.Visible = (btn.Text == currentTab)
                    tweenProperty(btn, "BackgroundColor3", 
                        btn.Text == currentTab and Color3.fromRGB(70, 35, 110) or CONFIG.DarkColor, 0.2)
                end
            end
        elseif input.KeyCode == Enum.KeyCode.F11 then
            currentTab = "SETTINGS"
            for frameName, frame in pairs(tabFrames) do
                frame.Visible = (frameName == currentTab)
            end
            for _, btn in ipairs(tabContainer:GetChildren()) do
                if btn:IsA("TextButton") then
                    btn.Highlight.Visible = (btn.Text == currentTab)
                    tweenProperty(btn, "BackgroundColor3", 
                        btn.Text == currentTab and Color3.fromRGB(70, 35, 110) or CONFIG.DarkColor, 0.2)
                end
            end
        end
    end
end)

---------------- FINAL INITIALIZATION ----------------
print([[
===============================================
üü£ MINH THU·∫¨N ULTIMATE HUB LOADED!
‚ö° Developer: D∆∞∆°ng Minh Thu·∫≠n
üéÆ Version: 3.3 Ultimate Fixed Edition
üéØ Features: Fix Lag + Hacks + Hitbox Expander
üìå Controls: 
   F9 = Toggle GUI
   F10 = Hack Tab
   F11 = Settings Tab
===============================================
]])

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "MINH THU·∫¨N ULTIMATE HUB",
    Text = "GUI ƒë√£ t·∫£i th√†nh c√¥ng!\nF9: ·∫®n/hi·ªán | F10: Hack | F11: Settings",
    Duration = 5,
    Icon = "rbxassetid://6723928013"
})
