--==================================================
-- MINH THUáº¬N HUB | UNIVERSAL FPS FIX
-- AIRHUB STYLE | MOBILE FRIENDLY
-- CLIENT SIDE ONLY
--==================================================

if getgenv().MINHTHUAN_HUB then return end
getgenv().MINHTHUAN_HUB = true

--------------------------------------------------
-- SERVICES
--------------------------------------------------
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

--------------------------------------------------
-- STATE
--------------------------------------------------
local State = {
    FX=false, Shake=false, Debris=false, Gray=false,
    Sound=false, Hide=false, Post=false, Shadow=false
}

--------------------------------------------------
-- SAFE FIX LAG FUNCTIONS (NO STAND BUG)
--------------------------------------------------
local function RemoveFX(on)
    for _,v in ipairs(workspace:GetDescendants()) do
        if v:IsA("ParticleEmitter") or v:IsA("Trail")
        or v:IsA("Beam") or v:IsA("Fire")
        or v:IsA("Smoke") or v:IsA("Sparkles") then
            v.Enabled = not on
        end
    end
end

local ShakeConn
local function DisableShake(on)
    if on then
        ShakeConn = RunService.RenderStepped:Connect(function()
            Camera.CFrame = Camera.CFrame
        end)
    elseif ShakeConn then
        ShakeConn:Disconnect()
        ShakeConn = nil
    end
end

local function RemoveDebris(on)
    if not on then return end
    for _,v in ipairs(workspace:GetChildren()) do
        if v:IsA("BasePart")
        and not v.Anchored
        and not v.CanCollide
        and v.Size.Magnitude < 20 then
            pcall(function() v:Destroy() end)
        end
    end
end

local function GrayCharacters(on)
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr.Character then
            for _,v in ipairs(plr.Character:GetDescendants()) do
                if v:IsA("BasePart") then
                    if on then
                        v.Material = Enum.Material.Plastic
                        v.Color = Color3.fromRGB(150,150,150)
                        v.CastShadow = false
                    end
                elseif v:IsA("Decal") or v:IsA("Texture") then
                    v.Transparency = on and 1 or 0
                end
            end
        end
    end
end

local function HidePlayers(on)
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character then
            for _,v in ipairs(plr.Character:GetDescendants()) do
                if v:IsA("BasePart") then
                    v.LocalTransparencyModifier = on and 1 or 0
                end
            end
        end
    end
end

local function DisableSound(on)
    for _,s in ipairs(workspace:GetDescendants()) do
        if s:IsA("Sound") then
            s.Volume = on and 0 or 1
            if on then s:Stop() end
        end
    end
end

local function DisablePost(on)
    for _,v in ipairs(Lighting:GetChildren()) do
        if v:IsA("PostEffect") then
            v.Enabled = not on
        end
    end
end

local function DisableShadow(on)
    Lighting.GlobalShadows = not on
end

--------------------------------------------------
-- SERVER FUNCTIONS
--------------------------------------------------
local function FindLowServer()
    local data = HttpService:JSONDecode(
        game:HttpGet(
            "https://games.roblox.com/v1/games/"..
            game.PlaceId.."/servers/Public?limit=100"
        )
    )
    table.sort(data.data,function(a,b)
        return a.playing < b.playing
    end)
    if data.data[1] then
        TeleportService:TeleportToPlaceInstance(
            game.PlaceId,data.data[1].id,LocalPlayer
        )
    end
end

local function Rejoin()
    TeleportService:Teleport(game.PlaceId,LocalPlayer)
end

--------------------------------------------------
-- GUI ROOT
--------------------------------------------------
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "MinhThuanHub"
gui.ResetOnSpawn = false

--------------------------------------------------
-- MAIN FRAME (AIRHUB STYLE)
--------------------------------------------------
local main = Instance.new("Frame", gui)
main.Size = UDim2.fromScale(0.9,0.72)
main.Position = UDim2.fromScale(0.05,0.15)
main.BackgroundColor3 = Color3.fromRGB(40,15,65)
main.Active = true
main.Draggable = true
Instance.new("UICorner", main).CornerRadius = UDim.new(0,18)

--------------------------------------------------
-- TITLE
--------------------------------------------------
local title = Instance.new("TextLabel", main)
title.Size = UDim2.fromScale(1,0.1)
title.BackgroundTransparency = 1
title.Text = "MINH THUáº¬N HUB"
title.TextScaled = true
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.fromRGB(230,200,255)

--------------------------------------------------
-- CREDIT
--------------------------------------------------
local credit = Instance.new("TextLabel", main)
credit.Position = UDim2.fromScale(0,0.92)
credit.Size = UDim2.fromScale(1,0.08)
credit.BackgroundTransparency = 1
credit.Text = "Credit: DÆ°Æ¡ng Minh Thuáº­n | Universal Fix Lag"
credit.TextScaled = true
credit.Font = Enum.Font.Gotham
credit.TextColor3 = Color3.fromRGB(180,150,220)

--------------------------------------------------
-- TAB BUTTONS
--------------------------------------------------
local tabMain = Instance.new("TextButton", main)
tabMain.Text = "MAIN"
tabMain.Size = UDim2.fromScale(0.45,0.1)
tabMain.Position = UDim2.fromScale(0.05,0.12)

local tabServer = Instance.new("TextButton", main)
tabServer.Text = "SERVER"
tabServer.Size = UDim2.fromScale(0.45,0.1)
tabServer.Position = UDim2.fromScale(0.5,0.12)

for _,b in ipairs({tabMain,tabServer}) do
    b.TextScaled = true
    b.Font = Enum.Font.GothamBold
    b.BackgroundColor3 = Color3.fromRGB(80,35,130)
    b.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,16)
end

--------------------------------------------------
-- CONTAINERS
--------------------------------------------------
local mainTab = Instance.new("Frame", main)
mainTab.Position = UDim2.fromScale(0,0.24)
mainTab.Size = UDim2.fromScale(1,0.66)
mainTab.BackgroundTransparency = 1

local serverTab = Instance.new("Frame", main)
serverTab.Position = mainTab.Position
serverTab.Size = mainTab.Size
serverTab.BackgroundTransparency = 1
serverTab.Visible = false

--------------------------------------------------
-- TOGGLE MAKER (BIG BUTTONS)
--------------------------------------------------
local function MakeToggle(parent,text,y,state,callback)
    local b = Instance.new("TextButton", parent)
    b.Position = UDim2.fromScale(0.05,y)
    b.Size = UDim2.fromScale(0.9,0.16)
    b.TextWrapped = true
    b.TextScaled = true
    b.Font = Enum.Font.GothamBold
    b.AutoButtonColor = false
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,18)

    local stroke = Instance.new("UIStroke", b)
    stroke.Thickness = 2
    stroke.Color = Color3.fromRGB(210,170,255)

    local function Refresh()
        b.Text = text.."\n"..(State[state] and "ON" or "OFF")
        b.BackgroundColor3 = State[state]
            and Color3.fromRGB(160,90,220)
            or Color3.fromRGB(80,40,130)
    end

    b.MouseButton1Click:Connect(function()
        State[state] = not State[state]
        callback(State[state])
        Refresh()
    end)

    Refresh()
end

--------------------------------------------------
-- MAIN TAB BUTTONS
--------------------------------------------------
MakeToggle(mainTab,"REMOVE EFFECTS\n(XÃ³a hiá»‡u á»©ng)",0.02,"FX",RemoveFX)
MakeToggle(mainTab,"CAMERA SHAKE\n(Táº¯t rung)",0.22,"Shake",DisableShake)
MakeToggle(mainTab,"REMOVE DEBRIS\n(XÃ³a part rÆ¡i)",0.42,"Debris",RemoveDebris)
MakeToggle(mainTab,"GRAY MODE\n(NhÃ¢n váº­t xÃ¡m)",0.62,"Gray",GrayCharacters)

--------------------------------------------------
-- SERVER TAB BUTTONS
--------------------------------------------------
local function ServerButton(text,y,func)
    local b = Instance.new("TextButton", serverTab)
    b.Position = UDim2.fromScale(0.05,y)
    b.Size = UDim2.fromScale(0.9,0.25)
    b.TextScaled = true
    b.Font = Enum.Font.GothamBold
    b.Text = text
    b.BackgroundColor3 = Color3.fromRGB(80,35,130)
    b.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,18)
    b.MouseButton1Click:Connect(func)
end

ServerButton("FIND LOW SERVER\n(Server Ã­t ngÆ°á»i)",0.15,FindLowServer)
ServerButton("REJOIN SERVER\n(VÃ o láº¡i server)",0.5,Rejoin)

--------------------------------------------------
-- TAB SWITCH
--------------------------------------------------
tabMain.MouseButton1Click:Connect(function()
    mainTab.Visible = true
    serverTab.Visible = false
end)
tabServer.MouseButton1Click:Connect(function()
    mainTab.Visible = false
    serverTab.Visible = true
end)

--------------------------------------------------
-- MINIMIZE + ROUND ICON ðŸ¥¼ðŸ‘“
--------------------------------------------------
local icon = Instance.new("TextButton", gui)
icon.Text = "ðŸ¥¼ðŸ‘“"
icon.Size = UDim2.fromScale(0.14,0.14)
icon.Position = UDim2.fromScale(0.05,0.45)
icon.TextScaled = true
icon.Font = Enum.Font.GothamBold
icon.TextColor3 = Color3.new(1,1,1)
icon.BackgroundColor3 = Color3.fromRGB(120,60,180)
icon.Visible = false
icon.Active = true
icon.Draggable = true
Instance.new("UICorner", icon).CornerRadius = UDim.new(1,0)

local iconStroke = Instance.new("UIStroke", icon)
iconStroke.Thickness = 3
iconStroke.Color = Color3.fromRGB(220,180,255)

local minimize = Instance.new("TextButton", main)
minimize.Text = "â€”"
minimize.Size = UDim2.fromScale(0.12,0.1)
minimize.Position = UDim2.fromScale(0.86,0.02)
minimize.TextScaled = true
minimize.Font = Enum.Font.GothamBold
minimize.BackgroundColor3 = Color3.fromRGB(90,40,140)
minimize.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", minimize).CornerRadius = UDim.new(0,16)

minimize.MouseButton1Click:Connect(function()
    main.Visible = false
    icon.Visible = true
end)

icon.MouseButton1Click:Connect(function()
    main.Visible = true
    icon.Visible = false
end)
